sidebar_position: 1

# 3.4.1 JDK ç®€ä»‹

JDK æ˜¯é’ˆå¯¹ SpacemiT **Kç³»åˆ—** å¹³å°å°è£…çš„ç®€æ´é«˜æ•ˆçš„ä¸Šå±‚**å¤šåª’ä½“å¤„ç†åº“ï¼ˆMPPï¼‰**ã€‚è¯¥åº“å°è£…äº†å¯¹æ‘„åƒå¤´ï¼ˆ`JdkCamera`ï¼‰ã€è§†é¢‘ç¼–ç ï¼ˆ`JdkEncoder`ï¼‰ã€è§£ç ï¼ˆ`JdkDecoder`ï¼‰ã€è§†é¢‘è¾“å‡ºï¼ˆ`JdkVo`ï¼‰ç­‰ç¡¬ä»¶åŠŸèƒ½çš„è®¿é—®æ¥å£ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿè°ƒç”¨ç¡¬ä»¶èƒ½åŠ›ã€‚

## ç¯å¢ƒå‡†å¤‡

- æ“ä½œç³»ç»Ÿï¼šBianbu 2.2
- ç¼–è¯‘å™¨ï¼šGCC 9 åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨å¼€å‘æ¿è‡ªå¸¦åŸç”Ÿç¼–è¯‘å™¨ï¼‰

**å¿…å¤‡ä¾èµ–åº“å®‰è£…å‘½ä»¤ï¼š**

```bash
sudo apt install build-essential cmake libv4l-dev libdrm-dev libjpeg-dev uuid-dev
```

## é¡¹ç›®ç»“æ„æ€»è§ˆ

```bash
jdk_examples
â”œâ”€â”€ jdk_cam       # æ‘„åƒå¤´æ¨¡å—
â”œâ”€â”€ jdk_client    # å®¢æˆ·ç«¯æ¨¡å—
â”œâ”€â”€ jdk_drm       # DRM ç›¸å…³æ¨¡å—
â”œâ”€â”€ jdk_frame     # å¸§å¤„ç†æ¨¡å—
â”œâ”€â”€ jdk_infer     # æ¨ç†æ¨¡å—
â”œâ”€â”€ jdk_server    # æœåŠ¡ç«¯æ¨¡å—
â”œâ”€â”€ jdk_v2d       # è§†é¢‘äºŒç»´æ¨¡å—
â”œâ”€â”€ jdk_vdec      # è§†é¢‘è§£ç æ¨¡å—
â”œâ”€â”€ jdk_venc      # è§†é¢‘ç¼–ç æ¨¡å—
â””â”€â”€ jdk_vo        # è§†é¢‘è¾“å‡ºæ¨¡å—
```

## ç¼–è¯‘æŒ‡å—

### JDK SDK ä¸‹è½½ä¸å®‰è£…

```bash
wget https://archive.spacemit.com/ros2/code/jdk_sdk.tar.gz
sudo tar xvf jdk_sdk.tar.gz
```

ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```shell
jdk_sdk
â”œâ”€â”€ include
â”‚Â Â  â”œâ”€â”€ data_type.hpp
â”‚Â Â  â”œâ”€â”€ IConver.hpp
â”‚Â Â  â”œâ”€â”€ IEngine.hpp
â”‚Â Â  â”œâ”€â”€ IPlugin.hpp
â”‚Â Â  â”œâ”€â”€ ITensor.hpp
â”‚Â Â  â”œâ”€â”€ JdkCamera.hpp
â”‚Â Â  â”œâ”€â”€ JdkDecoder.hpp
â”‚Â Â  â”œâ”€â”€ JdkDma.hpp
â”‚Â Â  â”œâ”€â”€ JdkDrm.hpp
â”‚Â Â  â”œâ”€â”€ JdkEncoder.hpp
â”‚Â Â  â”œâ”€â”€ JdkFrame.hpp
â”‚Â Â  â”œâ”€â”€ jdk_log.h
â”‚Â Â  â”œâ”€â”€ JdkUsbCam.hpp
â”‚Â Â  â”œâ”€â”€ jdkV2d.hpp
â”‚Â Â  â”œâ”€â”€ JdkVo.hpp
â”‚Â Â  â”œâ”€â”€ json.hpp
â”‚Â Â  â””â”€â”€ Tensor.hpp
â”œâ”€â”€ jdk_examples
â”‚Â Â  â”œâ”€â”€ jdk_cam
â”‚Â Â  â”œâ”€â”€ jdk_client
â”‚Â Â  â”œâ”€â”€ jdk_drm
â”‚Â Â  â”œâ”€â”€ jdk_frame
â”‚Â Â  â”œâ”€â”€ jdk_infer
â”‚Â Â  â”œâ”€â”€ jdk_infer@rtsp
â”‚Â Â  â”œâ”€â”€ jdk_server
â”‚Â Â  â”œâ”€â”€ jdk_usbcam
â”‚Â Â  â”œâ”€â”€ jdk_v2d
â”‚Â Â  â”œâ”€â”€ jdk_vdec
â”‚Â Â  â”œâ”€â”€ jdk_venc
â”‚Â Â  â””â”€â”€ jdk_vo
â”œâ”€â”€ ko
â”‚Â Â  â””â”€â”€ jdk_dma.ko
â”œâ”€â”€ lib
â”‚Â Â  â”œâ”€â”€ libengine.so
â”‚Â Â  â”œâ”€â”€ libjdk_cam.so
â”‚Â Â  â”œâ”€â”€ libjdk_dma.so
â”‚Â Â  â”œâ”€â”€ libjdk_drm.so
â”‚Â Â  â”œâ”€â”€ libjdk_frame.so
â”‚Â Â  â”œâ”€â”€ libjdk_usbcam.so
â”‚Â Â  â”œâ”€â”€ libjdk_v2d.so
â”‚Â Â  â”œâ”€â”€ libjdk_vdec.so
â”‚Â Â  â”œâ”€â”€ libjdk_venc.so
â”‚Â Â  â”œâ”€â”€ libjdk_vo.so
â”‚Â Â  â”œâ”€â”€ libnet_client.so
â”‚Â Â  â””â”€â”€ libnet_server.so
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

### ç¼–è¯‘ç¤ºä¾‹ç¨‹åº

è¿›å…¥æ‘„åƒå¤´æ¨¡å—ç›®å½•å¹¶ç¼–è¯‘ç¤ºä¾‹ï¼š

```bash
cd jdk_sdk
make all
```

ç¤ºä¾‹ç¼–è¯‘è¾“å‡ºï¼š

```bash
make -C jdk_examples/jdk_cam all
make[1]: Entering directory '/home/work/jdk_sdk/jdk_examples/jdk_cam'
Compile depends C++ src/main.cpp
Compile CXX src/main.cpp
Link workspace/jdk_cam
```

### è¿è¡Œç¤ºä¾‹

åœ¨è¿è¡Œ jdk ç¤ºä¾‹å‰ï¼Œéœ€è¦å…ˆå®‰è£… jdk dma é©±åŠ¨ã€‚

```shel
insmod ./ko/jdk_dma.ko
cd jdk_examples/jdk_usbcam
./workspace/jdk_usbcam /dev/video20
```

> ğŸš¨ æç¤ºï¼šè¯·æ ¹æ®å®é™…æƒ…å†µç¡®è®¤è®¾å¤‡èŠ‚ç‚¹è·¯å¾„ï¼Œå¦‚ `/dev/video20`ã€‚å¯é€šè¿‡ `v4l2-ctl --list-devices` å‘½ä»¤æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯ã€‚

è¿è¡Œåç»ˆç«¯å°†è¾“å‡ºæ¨¡å—åˆå§‹åŒ–ä¸å›¾åƒé‡‡é›†çš„æ—¥å¿—ä¿¡æ¯ã€‚

### å¯åŠ¨æ—¥å¿—ç¤ºä¾‹

~~~shell
VIDIOC_STREAMON succeeded
[MPP-DEBUG] 10800:module_init:159 +++++++++++++++ module init, module type = 9
[MPP-DEBUG] 10800:find_v4l2_linlonv5v7_plugin:83 yeah! we have v4l2_linlonv5v7_codec plugin---------------
[MPP-DEBUG] 10800:module_init:199 ++++++++++ V4L2_LINLONV5V7 (/usr/lib/libv4l2_linlonv5v7_codec.so)
[MPP-DEBUG] 10800:module_init:199 ++++++++++ open (/usr/lib/libv4l2_linlonv5v7_codec.so) success !
[MPP-DEBUG] 10800:al_dec_create:337 init create
[MPP-DEBUG] 10800:al_dec_init:398 input para check: foramt:0x4745504a output format:0x3231564e input buffer num:12 output buffer num:8
[MPP-DEBUG] 10800:al_dec_init:421 video fd = 4, device path = '/dev/video0'
[MPP-DEBUG] 10800:createCodec:115 create a codec, width=1280 height=720 align=1 inputtype=2 outputtype=9 inputformat=4745504a outputformat=3231564e inputbufnum=12 outputbufnum=8
[MPP-DEBUG] 10800:createPort:80 create a port, type=2 format_fourcc=1195724874
[MPP-DEBUG] 10800:createPort:80 create a port, type=9 format_fourcc=842094158
[MPP-DEBUG] 10800:getTrySetFormat:196 width=1280 height=720 align=1 pixel_format=4745504a
[MPP-DEBUG] 10800:printFormat:294 PRINTFORMAT ===== type: 2, format: 1195724874, width: 1280, height: 720, bytesperline: 0, sizeimage: 1048576
[MPP-DEBUG] 10800:getTrySetFormat:196 width=1280 height=720 align=1 pixel_format=3231564e
[MPP-DEBUG] 10800:printFormat:283 PRINTFORMAT ===== type: 9, format: 842094158, width: 1280, height: 720, nplanes: 2, bytesperline: [1280 1280 0], sizeimage: [921600 460800 0]
[MPP-DEBUG] 10800:allocateBuffers:340 Request buffers. type:2 count:12(12) memory:1
[MPP-DEBUG] 10800:allocateBuffers:340 Request buffers. type:9 count:8(8) memory:4
[MPP-DEBUG] 10800:streamon:558 Stream on 1751956058513
[MPP-DEBUG] 10800:streamon:558 Stream on 1751956058513
[MPP-DEBUG] 10800:al_dec_init:449 init finish
[MPP-DEBUG] 10800:VO_CreateChannel:43 create VO Channel success!
[MPP-DEBUG] 10800:module_init:159 +++++++++++++++ module init, module type = 101
[MPP-DEBUG] 10800:check_vo_sdl2:121 yeah! have vo_sdl2---------------
[MPP-DEBUG] 10800:find_vo_sdl2_plugin:86 yeah! we have vo_sdl2_plugin plugin---------------
[MPP-DEBUG] 10800:module_init:207 ++++++++++ VO_SDL2 (/usr/lib/libvo_sdl2_plugin.so)
[MPP-DEBUG] 10800:module_init:207 ++++++++++ open (/usr/lib/libvo_sdl2_plugin.so) success !
[MPP-ERROR] 10800:al_vo_init:93 SDL could not initialize! SDL_Error: wayland not available
[MPP-ERROR] 10800:al_vo_init:128 k1 vo_sdl2 init fail
[MPP-DEBUG] 10800:VO_Init:66 init VO Channel, ret = -400
[MPP-ERROR] 10800:JdkVo:32 VO_init failed, please check!
[MPP-INFO] 10801:runpoll:321 Now k1 hardware decoding ...
select: Resource temporarily unavailable
Failed to capture frame 0
NO data, return.
[MPP-DEBUG] 10801:handleEvent:453 get V4L2_EVENT_SOURCE_CHANGE event, do notify!
[MPP-DEBUG] 10800:handleOutputBuffer:1509 Resolution changed:0 new size: 1280 x 720
[MPP-DEBUG] 10800:streamoff:571 Stream off 1751956060839
[MPP-DEBUG] 10800:allocateBuffers:340 Request buffers. type:9 count:0(0) memory:4
[MPP-DEBUG] 10800:getTrySetFormat:196 width=1280 height=720 align=1 pixel_format=3231564e
[MPP-DEBUG] 10800:printFormat:283 PRINTFORMAT ===== type: 9, format: 842094158, width: 1280, height: 720, nplanes: 2, bytesperline: [1280 1280 0], sizeimage: [921600 460800 0]
[MPP-DEBUG] 10800:allocateBuffers:340 Request buffers. type:9 count:12(12) memory:4
[MPP-DEBUG] 10800:streamon:558 Stream on 1751956060850
[MPP-ERROR] 10800:queueBuffer:461 Failed to queue buffer. type = 9 (Invalid argument)
[MPP-ERROR] 10800:al_dec_return_output_frame:652 queueBuffer failed, this should not happen, please check!
[MPP-DEBUG] 10800:VO_Process:82 vo one packet, ret = 0
index:1,dma_fd:33 width:1280,height:720,size:1382400
[MPP-DEBUG] 10800:VO_Process:82 vo one packet, ret = 0
index:2,dma_fd:33 width:1280,height:720,size:1382400
[MPP-DEBUG] 10800:VO_Process:82 vo one packet, ret = 0
index:3,dma_fd:33 width:1280,height:720,size:1382400
~~~

## è¿è¡Œæ•ˆæœ

ç¨‹åºè¿è¡Œåï¼Œæ‘„åƒå¤´é‡‡é›†çš„å›¾åƒå°†åœ¨æ˜¾ç¤ºå™¨ä¸Šå®æ—¶æ˜¾ç¤ºï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![](images/usbcam_vo_image.jpg)

## å¸¸è§é—®é¢˜ä¸å»ºè®®

| é—®é¢˜           | è¯´æ˜                                            |
| -------------- | ----------------------------------------------- |
| æ£€æµ‹ä¸åˆ°æ‘„åƒå¤´ | æ£€æŸ¥ USB æ¥å£è¿æ¥ã€å°è¯•å…¶ä»–ç«¯å£ã€ç¡®è®¤æ‘„åƒå¤´å‹å· |
| æ‘„åƒå¤´æ‰“ä¸å¼€   | å¯èƒ½æ‘„åƒå¤´æœªè¢«è¯†åˆ«ï¼Œæˆ–é©±åŠ¨ä¸æ”¯æŒ                |
| SDL æŠ¥é”™       | ç³»ç»Ÿå›¾å½¢åº“ä¾èµ–ç¼ºå¤±ï¼Œä¸å½±å“æ‘„åƒå¤´é‡‡é›†åŠŸèƒ½        |
| å›¾åƒä¸æ˜¾ç¤º     | æ£€æŸ¥ vo åˆå§‹åŒ–æ—¥å¿—ã€ç¡®è®¤ä½¿ç”¨çš„æ˜¾ç¤ºé€šé“å’Œæƒé™    |
