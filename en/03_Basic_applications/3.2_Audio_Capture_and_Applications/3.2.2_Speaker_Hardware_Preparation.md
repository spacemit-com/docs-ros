sidebar_position: 2

# Speaker Hardware Setup and Debugging

## Supported Hardware and Protocols

- **Hardware Interfaces**：
  - USB microphones
  - USB sound cards
  - On-board I²S microphones (availability depends on the board variant)
- **Protocols**：
  - ALSA (Advanced Linux Sound Architecture)
  - PulseAudio (optional, mainly for development and debugging)

## Software and Hardware Environment

- **Operating System**: ROS2_LXQT
- **Recommended Hardware**: SpacemiT **MUSE Pi Pro** development board
- **Common Tools (development and debugging)**:
  - `audioscan` (lists all available capture and playback devices)
  - `arecord` (ALSA command-line audio recording tool)
  - `aplay` (ALSA command-line audio playback tool)
  - `alsamixer` (command-line mixer for volume and gain control)

## Install System Dependencies

```
sudo apt install python3-pyaudio python3-scipy libfftw3-dev \
portaudio19-dev libsndfile1-dev libcurl4-openssl-dev espeak-ng
```

## Speaker Connection

- Connect a USB speaker to one of the USB ports on the **MUSE Pi Pro** as below figure
- Any USB speaker compatible with Linux can be used

![](images/speaker1.png)

## Add User to the Audio Group

By default, general user may not have permission to access audio devices.
Add the current user to the `audio` group:

```bash
sudo usermod -aG audio $USER
```

Then, log out and log back in for the group change to take effect.

## Identify the Audio Device

Use `audioscan` to list all available audio devices:

```bash
audioscan
```

Example output:

![](./images/speaker2.png)

Ignore input (recording) devices when configuring speakers.

**Notes:**
- In this example, the USB microphone has a `device_index` of `2` (You can confirm the device by unplugging and replugging the microphone and observing the change.)
- The corresponding ALSA device identifier is **`hw:2,0`**.

In this guide, **48 kHz** is used.
(44.1 kHz is also acceptable, depending on application requirements.)

## Test Audio Recording

```bash
aplay -D "plughw:2,0" test.wav
```

If the command completes successfully, `test.wav` will contain the recorded audio and can be used for further validation or application testing.

## Volume Control

Check the volume level of a specific sound card:

```
amixer -c 2 sget PCM
```

The `-c` option specifies the sound card index.

Example output:

![](./images/speaker3.png)

**Set Playback Volume**

```
amixer -c 2 set PCM "100%"
```

Example output:

![](./images/speaker4.png)
